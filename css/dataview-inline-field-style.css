/*
 * Dataview inline field visual muting
 *
 * Softens rendered inline fields ([key:: value]) so they stay readable
 * but don't compete with task text.  Targets both Live Preview and
 * Reading View.
 *
 *   a) smaller font size
 *   b) medium-light gray text
 *   c) theme sans font (var(--font-text))
 *   d) transparent background, keep padding
 *   e) restore :: separator after key
 *   f) progressive reveal for id, parent, priority fields:
 *      - hidden when cursor is off the line
 *      - faded key labels shown when cursor is on the line
 *      - full [key:: value] shown when text cursor enters the field (CM6 native)
 *   g) prevent line-breaks within a field (wrap as a whole unit)
 */

/* ── Prevent line-breaks within fields ────────────────────────── */
/* Treat each [key:: value] as an atomic inline unit so the browser
   wraps the whole field to the next line rather than breaking inside. */

.dataview.inline-field {
  display: inline-block;
  white-space: nowrap;
  vertical-align: baseline;
}

.markdown-source-view.mod-cm6.is-live-preview .cm-content .dataview.inline-field {
  display: inline-block;
  white-space: nowrap;
  vertical-align: baseline;
}

/* ── Reading View ─────────────────────────────────────────────── */

.dataview.inline-field-key,
.dataview.inline-field-value {
  font-size: 0.8em;
  color: var(--text-faint);
  font-family: var(--font-text);
  background: transparent;
  background-color: transparent;
  padding-left: 0;
  padding-right: 0;
}

/* Restore :: separator after the key */
.dataview.inline-field-key::after {
  content: "::";
}

/* ── Live Preview ─────────────────────────────────────────────── */

.markdown-source-view.mod-cm6.is-live-preview .cm-content .dataview.inline-field-key,
.markdown-source-view.mod-cm6.is-live-preview .cm-content .dataview.inline-field-value {
  font-size: 0.8em;
  color: var(--text-faint);
  font-family: var(--font-text);
  background: transparent;
  background-color: transparent;
  padding-left: 0;
  padding-right: 0;
}

/* ── Progressive reveal for id, parent, priority fields ──────── */
/*
 * Three states:
 *   1. Cursor OFF line  → fully hidden
 *   2. Cursor ON line   → faded key labels only (no values, no brackets)
 *   3. Text cursor enters field → CM6 strips widget, shows raw markdown
 *
 * Reading View has no cursor concept, so fields stay fully hidden there.
 * State 3 is handled natively by CM6 (no CSS needed).
 */

/* ── State 1: wrapper fully hidden (both views) ──────────────── */
/* The wrapper <span class="dataview inline-field"> contains both
   key and value as children, so we must hide/show at this level. */

.dataview.inline-field:has(> [data-dv-key="id"]),
.dataview.inline-field:has(> [data-dv-key="parent"]),
.dataview.inline-field:has(> [data-dv-key="priority"]) {
  display: none !important;
}

/* ── State 2: active line — show wrapper, but only key label ── */
/* Override the wrapper to visible, then hide values inside it. */

.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="id"]),
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="parent"]),
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="priority"]) {
  display: inline !important;
}

/* Key labels: small and faded */
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="id"]) > .dataview.inline-field-key,
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="parent"]) > .dataview.inline-field-key,
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="priority"]) > .dataview.inline-field-key {
  display: inline !important;
  font-size: 0.75em;
  color: var(--text-faint);
  opacity: 0.5;
}

/* Replace :: separator with ] to close the bracket */
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="id"]) > .dataview.inline-field-key::after,
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="parent"]) > .dataview.inline-field-key::after,
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="priority"]) > .dataview.inline-field-key::after {
  content: "]";
}

/* Hide value spans on active line */
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="id"]) > .dataview.inline-field-value,
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="parent"]) > .dataview.inline-field-value,
.cm-line.cm-active .dataview.inline-field:has(> [data-dv-key="priority"]) > .dataview.inline-field-value {
  display: none !important;
}

/* ── Bracket muting for other visible fields ─────────────────── */
.markdown-source-view.mod-cm6.is-live-preview .cm-content .dataview.inline-field-key::before,
.markdown-source-view.mod-cm6.is-live-preview .cm-content .dataview.inline-field-value::after {
  color: var(--text-faint);
  font-family: var(--font-text);
  font-size: inherit;
}
